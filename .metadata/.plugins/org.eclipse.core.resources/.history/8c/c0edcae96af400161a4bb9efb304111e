package NetNinny;

import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.Socket;

public class ProxyThread extends Thread{
	
	final private static String[] URL_BLIST = {"http://www.ida.liu.se/~TDTS04/labs/2011/ass2/SpongeBob.html"};
	final private static String[] CONTENT_BLIST = {"spongebob"};
	
	final private static String R_HOST = "www.ida.liu.se";
	final private static String R_URL = "http://www.ida.liu.se/~TDTS04/labs/2011/ass2/error1.html";
	//final private static String R_CONTENT = "http://www.ida.liu.se/~TDTS04/labs/2011/ass2/error2.html";
	

	final private static int RQ_BUFFER = 10240;
	final private static int RP_BUFFER = 40960;
	
	private boolean debug;

	private byte[] request;
	private byte[] response;
	
	private int reqBytes;
	private int respBytes;

	//Client
	private Socket sClient;

	private InputStream fromClient;
	private OutputStream toClient;

	//Server 
	private final int SERVER_PORT = 80;

	private Socket sServer;
	
	private InputStream fromServer;
	private OutputStream toServer;
	
	private String url;
	private String serverHost;



	public ProxyThread(Socket sClient, boolean debug){
		
		request = new byte[RQ_BUFFER];
		response = new byte[RP_BUFFER];

		this.sClient = sClient;
		this.debug = debug;
		

		try{
			this.fromClient = sClient.getInputStream();
			this.toClient = sClient.getOutputStream();
		}catch(IOException e){
			System.out.println("[-] ("+this.getName()+") Error connecting to client");
		}
		

		this.start();
	}


	@Override
	public void run(){
		System.out.println("[+] ("+this.getName()+") New connection from "+sClient.getRemoteSocketAddress());
		if (getRequest()){
			sendToServer();
			sendToClient();
		}
		System.out.println("[+] ("+this.getName()+") Exiting...");
		return;
	}

}
